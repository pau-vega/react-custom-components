import{r as a}from"./index-Br2IOmUs.js";import{u as T}from"./empty-BwNtW-GQ.js";import{u as l}from"./useStableCallback-CgA2ffE5.js";import{u as f}from"./useIsoLayoutEffect-B3i3ZXBb.js";import{C as x}from"./useCompositeListItem-2W6IGSyp.js";import{j as D}from"./jsx-runtime-D_zvdyIk.js";function y(h){const{children:N,elementsRef:t,labelsRef:o,onMapChange:_}=h,E=l(_),O=a.useRef(0),d=T(P).current,i=T(L).current,[p,C]=a.useState(0),c=a.useRef(p),M=l((e,u)=>{i.set(e,u??null),c.current+=1,C(c.current)}),I=l(e=>{i.delete(e),c.current+=1,C(c.current)}),r=a.useMemo(()=>{const e=new Map;return Array.from(i.keys()).filter(n=>n.isConnected).sort(R).forEach((n,m)=>{const s=i.get(n)??{};e.set(n,{...s,index:m})}),e},[i,p]);f(()=>{if(typeof MutationObserver!="function"||r.size===0)return;const e=new MutationObserver(u=>{const n=new Set,m=s=>n.has(s)?n.delete(s):n.add(s);u.forEach(s=>{s.removedNodes.forEach(m),s.addedNodes.forEach(m)}),n.size===0&&(c.current+=1,C(c.current))});return r.forEach((u,n)=>{n.parentElement&&e.observe(n.parentElement,{childList:!0})}),()=>{e.disconnect()}},[r]),f(()=>{c.current===p&&(t.current.length!==r.size&&(t.current.length=r.size),o&&o.current.length!==r.size&&(o.current.length=r.size),O.current=r.size),E(r)},[E,r,t,o,p]),f(()=>()=>{t.current=[]},[t]),f(()=>()=>{o&&(o.current=[])},[o]);const g=l(e=>(d.add(e),()=>{d.delete(e)}));f(()=>{d.forEach(e=>e(r))},[d,r]);const b=a.useMemo(()=>({register:M,unregister:I,subscribeMapChange:g,elementsRef:t,labelsRef:o,nextIndexRef:O}),[M,I,g,t,o,O]);return D.jsx(x.Provider,{value:b,children:N})}function L(){return new Map}function P(){return new Set}function R(h,N){const t=h.compareDocumentPosition(N);return t&Node.DOCUMENT_POSITION_FOLLOWING||t&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:t&Node.DOCUMENT_POSITION_PRECEDING||t&Node.DOCUMENT_POSITION_CONTAINS?1:0}export{y as C};
