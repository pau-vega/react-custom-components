import{r as m}from"./index-Br2IOmUs.js";import{u as T}from"./useStableCallback-CgA2ffE5.js";import{u as d}from"./useIsoLayoutEffect-B3i3ZXBb.js";import{u as v,a as S}from"./useTransitionStatus-H-zITwNf.js";import{g as C}from"./getEmptyRootContext-DHQYzQq2.js";import{E as f,u as x}from"./empty-BwNtW-GQ.js";import{f as r,u as I,F as R}from"./useInteractions-DLoJm_bm.js";import{a as y}from"./useBaseUiId-Ds3dA0Bv.js";import{i as O}from"./floating-ui.utils.dom-BR__G8pa.js";function P(e,t){const n=m.useRef(null),i=m.useRef(null);return m.useCallback(o=>{if(e!==void 0){if(n.current!==null){const u=n.current,l=i.current,s=t.context.triggerElements.getById(u);l&&s===l&&t.context.triggerElements.delete(u),n.current=null,i.current=null}o!==null&&(n.current=e,i.current=o,t.context.triggerElements.add(e,o))}},[t,e])}function z(e,t,n,i){const o=n.useState("isMountedByTrigger",e),u=P(e,n),l=T(s=>{if(u(s),!s||!n.select("open"))return;const a=n.select("activeTriggerId");if(a===e){n.update({activeTriggerElement:s,...i});return}a==null&&n.update({activeTriggerId:e,activeTriggerElement:s,...i})});return d(()=>{o&&n.update({activeTriggerElement:t.current,...i})},[o,n,t,...Object.values(i)]),{registerTrigger:l,isMountedByThisTrigger:o}}function D(e){const t=e.useState("open");d(()=>{if(t&&!e.select("activeTriggerId")&&e.context.triggerElements.size===1){const n=e.context.triggerElements.entries().next();if(!n.done){const[i,o]=n.value;e.update({activeTriggerId:i,activeTriggerElement:o})}}},[t,e])}function J(e,t,n){const{mounted:i,setMounted:o,transitionStatus:u}=v(e);t.useSyncedValues({mounted:i,transitionStatus:u});const l=T(()=>{var a,c;o(!1),t.update({activeTriggerId:null,activeTriggerElement:null,mounted:!1}),n==null||n(),(c=(a=t.context).onOpenChangeComplete)==null||c.call(a,!1)}),s=t.useState("preventUnmountingOnClose");return S({enabled:!s,open:e,ref:t.context.popupRef,onComplete(){e||l()}}),{forceUnmount:l,transitionStatus:u}}function L(){return{open:!1,mounted:!1,transitionStatus:"idle",floatingRootContext:C(),preventUnmountingOnClose:!1,payload:void 0,activeTriggerId:null,activeTriggerElement:null,popupElement:null,positionerElement:null,activeTriggerProps:f,inactiveTriggerProps:f,popupProps:f}}const N={open:r(e=>e.open),mounted:r(e=>e.mounted),transitionStatus:r(e=>e.transitionStatus),floatingRootContext:r(e=>e.floatingRootContext),preventUnmountingOnClose:r(e=>e.preventUnmountingOnClose),payload:r(e=>e.payload),activeTriggerId:r(e=>e.activeTriggerId),activeTriggerElement:r(e=>e.mounted?e.activeTriggerElement:null),isTriggerActive:r((e,t)=>t!==void 0&&e.activeTriggerId===t),isOpenedByTrigger:r((e,t)=>t!==void 0&&e.activeTriggerId===t&&e.open),isMountedByTrigger:r((e,t)=>t!==void 0&&e.activeTriggerId===t&&e.mounted),triggerProps:r((e,t)=>t?e.activeTriggerProps:e.inactiveTriggerProps),popupProps:r(e=>e.popupProps),popupElement:r(e=>e.popupElement),positionerElement:r(e=>e.positionerElement)};function V(e){const{popupStore:t,noEmit:n=!1,treatPopupAsFloatingElement:i=!1,onOpenChange:o}=e,u=y(),l=I()!=null,s=t.useState("open"),a=t.useState("activeTriggerElement"),c=t.useState(i?"popupElement":"positionerElement"),E=t.context.triggerElements,g=x(()=>new R({open:s,referenceElement:a,floatingElement:c,triggerElements:E,onOpenChange:o,floatingId:u,nested:l,noEmit:n})).current;return d(()=>{const p={open:s,floatingId:u,referenceElement:a,floatingElement:c};O(a)&&(p.domReferenceElement=a),g.state.positionReference===g.state.referenceElement&&(p.positionReference=a),g.update(p)},[s,u,a,c,g]),g.context.onOpenChange=o,g.context.nested=l,g.context.noEmit=n,g}export{D as a,J as b,V as c,L as d,P as e,N as p,z as u};
