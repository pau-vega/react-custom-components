import{r as i}from"./index-Br2IOmUs.js";import{i as se}from"./floating-ui.utils.dom-BR__G8pa.js";import{u as P}from"./useStableCallback-CgA2ffE5.js";import{u as re}from"./useIsoLayoutEffect-B3i3ZXBb.js";import{c as Y,b as _}from"./createBaseUIEventDetails-BfRHIGKf.js";import{c as ae,a as ce,u as le}from"./useInteractions-DLoJm_bm.js";import{c as K,e as fe,d as G}from"./element-vmEcGomw.js";import{i as ee}from"./event-D_tFMKDJ.js";import{r as me}from"./index-B1jiiJTD.js";import{u as Q}from"./useValueAsRef-uCcb0GiG.js";import{g as U}from"./safePolygon-B1_E0Dln.js";import{u as oe}from"./useTimeout-DEENwbcq.js";import{T as de}from"./constants-CRqqCNE_.js";const te=ae("safe-polygon"),ge=`button,a,[role="button"],select,[tabindex]:not([tabindex="-1"]),${de}`;function Ee(r){return r?!!r.closest(ge):!1}function ue(r){const b=i.useRef(void 0),e=i.useRef(!1),l=i.useRef(void 0),g=i.useRef(!0),R=i.useRef(!1),C=i.useRef(()=>{}),k=i.useRef(!1),M=oe(),W=oe(),y=i.useRef(void 0);return i.useMemo(()=>{const f=r.context.dataRef.current;return f.hoverInteractionState||(f.hoverInteractionState={pointerTypeRef:b,interactedInsideRef:e,handlerRef:l,blockMouseMoveRef:g,performedPointerEventsMutationRef:R,unbindMouseMoveRef:C,restTimeoutPendingRef:k,openChangeTimeout:M,restTimeout:W,handleCloseOptionsRef:y}),f.hoverInteractionState},[r,b,e,l,g,R,C,k,M,W,y])}const pe=new Set(["click","mousedown"]);function De(r,b={}){const e="rootStore"in r?r.rootStore:r,l=e.useState("open"),g=e.useState("floatingElement"),R=e.useState("domReferenceElement"),{dataRef:C}=e.context,{enabled:k=!0,closeDelay:M=0,externalTree:W}=b,{pointerTypeRef:y,interactedInsideRef:f,handlerRef:D,performedPointerEventsMutationRef:H,unbindMouseMoveRef:j,restTimeoutPendingRef:E,openChangeTimeout:$,handleCloseOptionsRef:O}=ue(e),h=ce(W),q=le(),w=P(()=>f.current?!0:C.current.openEvent?pe.has(C.current.openEvent.type):!1),T=P(()=>{var u;const n=(u=C.current.openEvent)==null?void 0:u.type;return(n==null?void 0:n.includes("mouse"))&&n!=="mousedown"}),p=i.useCallback((n,u=!0)=>{const a=ve(M,y.current);a&&!D.current?$.start(a,()=>e.setOpen(!1,Y(_,n))):u&&($.clear(),e.setOpen(!1,Y(_,n)))},[M,D,e,y,$]),m=P(()=>{j.current(),D.current=void 0}),A=P(()=>{if(H.current){const n=K(g).body;n.style.pointerEvents="",n.removeAttribute(te),H.current=!1}}),L=P(n=>{const u=fe(n);if(!Ee(u)){f.current=!1;return}f.current=!0});re(()=>{l||(y.current=void 0,E.current=!1,f.current=!1,m(),A())},[l,y,E,f,m,A]),i.useEffect(()=>()=>{m()},[m]),i.useEffect(()=>A,[A]),re(()=>{var n,u,a;if(k&&l&&(n=O.current)!=null&&n.blockPointerEvents&&T()&&se(R)&&g){H.current=!0;const c=K(g).body;c.setAttribute(te,"");const d=R,v=g,z=(a=(u=h==null?void 0:h.nodesRef.current.find(J=>J.id===q))==null?void 0:u.context)==null?void 0:a.elements.floating;return z&&(z.style.pointerEvents=""),c.style.pointerEvents="none",d.style.pointerEvents="auto",v.style.pointerEvents="auto",()=>{c.style.pointerEvents="",d.style.pointerEvents="",v.style.pointerEvents=""}}},[k,l,R,g,O,T,h,q,H]),i.useEffect(()=>{if(!k)return;function n(d){if(w()||!C.current.floatingContext||!e.select("open"))return;const v=e.context.triggerElements;d.relatedTarget&&v.hasElement(d.relatedTarget)||(A(),m(),w()||p(d))}function u(d){var v;$.clear(),A(),(v=D.current)==null||v.call(D,d),m()}function a(d){w()||p(d,!1)}const c=g;return c&&(c.addEventListener("mouseleave",n),c.addEventListener("mouseenter",u),c.addEventListener("mouseleave",a),c.addEventListener("pointerdown",L,!0)),()=>{c&&(c.removeEventListener("mouseleave",n),c.removeEventListener("mouseenter",u),c.removeEventListener("mouseleave",a),c.removeEventListener("pointerdown",L,!0))}})}function ve(r,b){return b&&!ee(b)?0:typeof r=="function"?r():r}function Z(r){return typeof r=="function"?r():r}const Re={current:null};function He(r,b={}){var J;const e="rootStore"in r?r.rootStore:r,{dataRef:l,events:g}=e.context,{enabled:R=!0,delay:C=0,handleClose:k=null,mouseOnly:M=!1,restMs:W=0,move:y=!0,triggerElementRef:f=Re,externalTree:D,isActiveTrigger:H=!0}=b,j=ce(D),{pointerTypeRef:E,interactedInsideRef:$,handlerRef:O,blockMouseMoveRef:h,performedPointerEventsMutationRef:q,unbindMouseMoveRef:w,restTimeoutPendingRef:T,openChangeTimeout:p,restTimeout:m,handleCloseOptionsRef:A}=ue(e),L=Q(k),n=Q(C),u=Q(W);H&&(A.current=(J=L.current)==null?void 0:J.__options);const a=P(()=>$.current?!0:l.current.openEvent?["click","mousedown"].includes(l.current.openEvent.type):!1),c=i.useCallback((t,s=!0)=>{const S=U(n.current,"close",E.current);S&&!O.current?p.start(S,()=>e.setOpen(!1,Y(_,t))):s&&(p.clear(),e.setOpen(!1,Y(_,t)))},[n,O,e,E,p]),d=P(()=>{w.current(),O.current=void 0}),v=P(()=>{if(q.current){const t=K(e.select("domReferenceElement")).body;t.style.pointerEvents="",t.removeAttribute(te),q.current=!1}});i.useEffect(()=>{if(!R)return;function t(s){s.open||(p.clear(),m.clear(),h.current=!0,T.current=!1)}return g.on("openchange",t),()=>{g.off("openchange",t)}},[R,g,p,m,h,T]);const z=P(t=>{var X;if(a()||!l.current.floatingContext)return;const s=e.context.triggerElements;if(t.relatedTarget&&s.hasElement(t.relatedTarget))return;const S=f.current;(X=L.current)==null||X.call(L,{...l.current.floatingContext,tree:j,x:t.clientX,y:t.clientY,onClose(){v(),d(),!a()&&S===e.select("domReferenceElement")&&c(t)}})(t)});return i.useEffect(()=>{if(!R)return;const t=f.current??(H?e.select("domReferenceElement"):null);if(!se(t))return;function s(o){if(p.clear(),h.current=!1,M&&!ee(E.current)||Z(u.current)>0&&!U(n.current,"open"))return;const B=U(n.current,"open",E.current),F=e.select("domReferenceElement"),x=e.context.triggerElements,N=(x.hasElement(o.target)||x.hasMatchingElement(ie=>G(ie,o.target)))&&(!F||!G(F,o.target)),I=o.currentTarget??null,V=e.select("open"),ne=!V||N;N&&V?e.setOpen(!0,Y(_,o,I)):B?p.start(B,()=>{ne&&e.setOpen(!0,Y(_,o,I))}):ne&&e.setOpen(!0,Y(_,o,I))}function S(o){if(a()){v();return}w.current();const B=e.select("domReferenceElement"),F=K(B);m.clear(),T.current=!1;const x=e.context.triggerElements;if(o.relatedTarget&&x.hasElement(o.relatedTarget))return;if(L.current&&l.current.floatingContext){e.select("open")||p.clear();const I=f.current;O.current=L.current({...l.current.floatingContext,tree:j,x:o.clientX,y:o.clientY,onClose(){v(),d(),!a()&&I===e.select("domReferenceElement")&&c(o,!0)}});const V=O.current;V(o),F.addEventListener("mousemove",V),w.current=()=>{F.removeEventListener("mousemove",V)};return}(E.current==="touch"?!G(e.select("floatingElement"),o.relatedTarget):!0)&&c(o)}function X(o){z(o)}return e.select("open")&&t.addEventListener("mouseleave",X),y&&t.addEventListener("mousemove",s,{once:!0}),t.addEventListener("mouseenter",s),t.addEventListener("mouseleave",S),()=>{t.removeEventListener("mouseleave",X),y&&t.removeEventListener("mousemove",s),t.removeEventListener("mouseenter",s),t.removeEventListener("mouseleave",S)}},[d,v,h,l,n,c,e,R,L,z,H,a,M,y,E,u,m,T,p,f,j,w,O]),i.useMemo(()=>{function t(s){E.current=s.pointerType}return{onPointerDown:t,onPointerEnter:t,onMouseMove(s){const{nativeEvent:S}=s,X=s.currentTarget,o=e.select("domReferenceElement"),B=e.context.triggerElements,F=e.select("open"),x=(B.hasElement(s.target)||B.hasMatchingElement(I=>G(I,s.target)))&&(!o||!G(o,s.target));if(M&&!ee(E.current)||F&&!x||Z(u.current)===0||!x&&T.current&&s.movementX**2+s.movementY**2<2)return;m.clear();function N(){if(T.current=!1,a())return;const I=e.select("open");!h.current&&(!I||x)&&e.setOpen(!0,Y(_,S,X))}E.current==="touch"?me.flushSync(()=>{N()}):x&&F?N():(T.current=!0,m.start(Z(u.current),N))}}},[h,a,M,e,E,u,m,T])}export{De as a,He as u};
