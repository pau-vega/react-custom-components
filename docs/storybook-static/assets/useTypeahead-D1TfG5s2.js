import{r as o}from"./index-Br2IOmUs.js";import{u as O}from"./useStableCallback-CgA2ffE5.js";import{u as b}from"./useIsoLayoutEffect-B3i3ZXBb.js";import{u as U}from"./useTimeout-DEENwbcq.js";import{a as _}from"./empty-BwNtW-GQ.js";import{s as A}from"./event-D_tFMKDJ.js";function N(p,F){const M="rootStore"in p?p.rootStore:p,c=M.useState("open"),a=M.context.dataRef,{listRef:Y,activeIndex:d,onMatch:R,onTypingChange:n,enabled:g=!0,findMatch:K=null,resetMs:D=750,ignoreKeys:T=_,selectedIndex:L=null}=F,k=U(),r=o.useRef(""),l=o.useRef(L??d??-1),m=o.useRef(null);b(()=>{c&&(k.clear(),m.current=null,r.current="")},[c,k]),b(()=>{c&&r.current===""&&(l.current=L??d??-1)},[c,L,d]);const s=O(e=>{e?a.current.typing||(a.current.typing=e,n==null||n(e)):a.current.typing&&(a.current.typing=e,n==null||n(e))}),y=O(e=>{function x(u,i,f){const E=K?K(i,f):i.find(I=>(I==null?void 0:I.toLocaleLowerCase().indexOf(f.toLocaleLowerCase()))===0);return E?u.indexOf(E):-1}const t=Y.current;if(r.current.length>0&&r.current[0]!==" "&&(x(t,t,r.current)===-1?s(!1):e.key===" "&&A(e)),t==null||T.includes(e.key)||e.key.length!==1||e.ctrlKey||e.metaKey||e.altKey)return;c&&e.key!==" "&&(A(e),s(!0)),t.every(u=>{var i,f;return u?((i=u[0])==null?void 0:i.toLocaleLowerCase())!==((f=u[1])==null?void 0:f.toLocaleLowerCase()):!0})&&r.current===e.key&&(r.current="",l.current=m.current),r.current+=e.key,k.start(D,()=>{r.current="",l.current=m.current,s(!1)});const C=l.current,w=x(t,[...t.slice((C||0)+1),...t.slice(0,(C||0)+1)],r.current);w!==-1?(R==null||R(w),m.current=w):e.key!==" "&&(r.current="",s(!1))}),S=o.useMemo(()=>({onKeyDown:y}),[y]),h=o.useMemo(()=>({onKeyDown:y,onKeyUp(e){e.key===" "&&s(!1)}}),[y,s]);return o.useMemo(()=>g?{reference:S,floating:h}:{},[g,S,h])}export{N as u};
