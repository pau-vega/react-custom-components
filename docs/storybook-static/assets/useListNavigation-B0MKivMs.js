import{r as d}from"./index-Br2IOmUs.js";import{a as Me}from"./floating-ui.utils.dom-BR__G8pa.js";import{u as k}from"./useValueAsRef-uCcb0GiG.js";import{u as ae}from"./useStableCallback-CgA2ffE5.js";import{u as K}from"./useIsoLayoutEffect-B3i3ZXBb.js";import{u as ze,a as Ge}from"./useInteractions-DLoJm_bm.js";import{c as X,l as le,f as We}from"./createBaseUIEventDetails-BfRHIGKf.js";import{e as _e}from"./useOpenInteractionType-DABt_JZJ.js";import{a as ee,b as _,c as q,A as Te}from"./constants-CRqqCNE_.js";import{g as qe,a as He,b as we,c as $e,d as ve,e as Be}from"./element-vmEcGomw.js";import{i as Pe,g as fe,a as Ce,c as Ue,b as de,d as je,e as Je,f as Qe,h as Y}from"./composite-RvPlRQ7I.js";import{s as S,b as Xe,c as Ye}from"./event-D_tFMKDJ.js";const Ze="Escape";function re(c,g,u){switch(c){case"vertical":return g;case"horizontal":return u;default:return g||u}}function Z(c,g){return re(g,c===Te||c===ee,c===_||c===q)}function me(c,g,u){return re(g,c===ee,u?c===_:c===q)||c==="Enter"||c===" "||c===""}function er(c,g,u){return re(g,u?c===_:c===q,c===ee)}function rr(c,g,u,a){const I=u?c===q:c===_,E=c===Te;return g==="both"||g==="horizontal"&&a&&a>1?c===Ze:re(g,I,E)}function pr(c,g){const u="rootStore"in c?c.rootStore:c,a=u.useState("open"),I=u.useState("floatingElement"),E=u.useState("domReferenceElement"),pe=u.context.dataRef,{listRef:o,activeIndex:w,onNavigate:Se=()=>{},enabled:b=!0,selectedIndex:D=null,allowEscape:ge=!1,loopFocus:te=!1,nested:v=!1,rtl:y=!1,virtual:m=!1,focusItemOnOpen:P="auto",focusItemOnHover:ne=!0,openOnArrowKeyDown:oe=!0,disabledIndices:h=void 0,orientation:p="vertical",parentOrientation:Ie,cols:L=1,scrollItemIntoView:Ae=!0,itemSizes:Fe,dense:ke=!1,id:Re,resetOnPointerLeave:Ke=!0,externalTree:De}=g,Le=qe(I),V=k(Le),H=ze(),R=Ge(De);K(()=>{pe.current.orientation=p},[pe,p]);const ce=He(E),C=d.useRef(P),t=d.useRef(D??-1),T=d.useRef(null),A=d.useRef(!0),l=ae(e=>{Se(t.current===-1?null:t.current,e)}),he=d.useRef(l),N=d.useRef(!!I),xe=d.useRef(a),x=d.useRef(!1),$=d.useRef(!1),se=k(h),B=k(a),Ve=k(Ae),z=k(D),Oe=k(Ke),ue=ae(()=>{function e(i){m?R==null||R.events.emit("virtualfocus",i):_e(i,{sync:x.current,preventScroll:!0})}const n=o.current[t.current],r=$.current;n&&e(n),(x.current?i=>i():requestAnimationFrame)(()=>{var F;const i=o.current[t.current]||n;if(!i)return;n||e(i);const f=Ve.current;f&&ie&&(r||!A.current)&&((F=i.scrollIntoView)==null||F.call(i,typeof f=="boolean"?{block:"nearest",inline:"nearest"}:f))})});K(()=>{b&&(a&&I?(t.current=D??-1,C.current&&D!=null&&($.current=!0,l())):N.current&&(t.current=-1,he.current()))},[b,a,I,D,l]),K(()=>{if(b){if(!a){x.current=!1;return}if(I)if(w==null){if(x.current=!1,z.current!=null)return;if(N.current&&(t.current=-1,ue()),(!xe.current||!N.current)&&C.current&&(T.current!=null||C.current===!0&&T.current==null)){let e=0;const n=()=>{o.current[0]==null?(e<2&&(e?requestAnimationFrame:queueMicrotask)(n),e+=1):(t.current=T.current==null||me(T.current,p,y)||v?fe(o):Ce(o),T.current=null,l())};n()}}else Pe(o,w)||(t.current=w,ue(),$.current=!1)}},[b,a,I,w,z,v,o,p,y,l,ue,se]),K(()=>{var i,f;if(!b||I||!R||m||!N.current)return;const e=R.nodesRef.current,n=(f=(i=e.find(O=>O.id===H))==null?void 0:i.context)==null?void 0:f.elements.floating,r=we($e(I)),s=e.some(O=>O.context&&ve(O.context.elements.floating,r));n&&!s&&A.current&&n.focus({preventScroll:!0})},[b,I,R,H,m]),K(()=>{he.current=l,xe.current=a,N.current=!!I}),K(()=>{a||(T.current=null,C.current=P)},[a,P]);const Ee=w!=null,ie=d.useMemo(()=>{function e(r){if(!B.current)return;const s=o.current.indexOf(r.currentTarget);s!==-1&&t.current!==s&&(t.current=s,l(r))}return{onFocus(r){x.current=!0,e(r)},onClick:({currentTarget:r})=>r.focus({preventScroll:!0}),onMouseMove(r){x.current=!0,$.current=!1,ne&&e(r)},onPointerLeave(r){var i;if(!B.current||!A.current||r.pointerType==="touch")return;x.current=!0;const s=r.relatedTarget;!ne||o.current.includes(s)||Oe.current&&(t.current=-1,l(r),m||(i=V.current)==null||i.focus({preventScroll:!0}))}}},[B,V,ne,o,l,Oe,m]),U=d.useCallback(()=>{var e,n,r;return Ie??((r=(n=(e=R==null?void 0:R.nodesRef.current.find(s=>s.id===H))==null?void 0:e.context)==null?void 0:n.dataRef)==null?void 0:r.current.orientation)},[H,R,Ie]),G=ae(e=>{if(A.current=!1,x.current=!0,e.which===229||!B.current&&e.currentTarget===V.current)return;if(v&&rr(e.key,p,y,L)){Z(e.key,U())||S(e),u.setOpen(!1,X(le,e.nativeEvent)),Me(E)&&(m?R==null||R.events.emit("virtualfocus",E):E.focus());return}const n=t.current,r=fe(o,h),s=Ce(o,h);if(ce||(e.key==="Home"&&(S(e),t.current=r,l(e)),e.key==="End"&&(S(e),t.current=s,l(e))),L>1){const i=Fe||Array.from({length:o.current.length},()=>({width:1,height:1})),f=Ue(i,L,ke),O=f.findIndex(M=>M!=null&&!de(o,M,h)),F=f.reduce((M,W,Ne)=>W!=null&&!de(o,W,h)?Ne:M,-1),Q=f[je({current:f.map(M=>M!=null?o.current[M]:null)},{event:e,orientation:p,loopFocus:te,rtl:y,cols:L,disabledIndices:Qe([...(typeof h!="function"?h:null)||o.current.map((M,W)=>de(o,W,h)?W:void 0),void 0],f),minIndex:O,maxIndex:F,prevIndex:Je(t.current>s?r:t.current,i,f,L,e.key===ee?"bl":e.key===(y?_:q)?"tr":"tl"),stopEvent:!0})];if(Q!=null&&(t.current=Q,l(e)),p==="both")return}if(Z(e.key,p)){if(S(e),a&&!m&&we(e.currentTarget.ownerDocument)===e.currentTarget){t.current=me(e.key,p,y)?r:s,l(e);return}me(e.key,p,y)?te?n>=s?ge&&n!==o.current.length?t.current=-1:(x.current=!1,t.current=r):t.current=Y(o,{startingIndex:n,disabledIndices:h}):t.current=Math.min(s,Y(o,{startingIndex:n,disabledIndices:h})):te?n<=r?ge&&n!==-1?t.current=o.current.length:(x.current=!1,t.current=s):t.current=Y(o,{startingIndex:n,decrement:!0,disabledIndices:h}):t.current=Math.max(r,Y(o,{startingIndex:n,decrement:!0,disabledIndices:h})),Pe(o,t.current)&&(t.current=-1),l(e)}}),j=d.useMemo(()=>m&&a&&Ee&&{"aria-activedescendant":`${Re}-${w}`},[m,a,Ee,Re,w]),ye=d.useMemo(()=>({"aria-orientation":p==="both"?void 0:p,...ce?{}:j,onKeyDown(e){if(e.key==="Tab"&&e.shiftKey&&a&&!m){const n=Be(e.nativeEvent);if(n&&!ve(V.current,n))return;S(e),u.setOpen(!1,X(We,e.nativeEvent)),Me(E)&&E.focus();return}G(e)},onPointerMove(){A.current=!0}}),[j,G,V,p,ce,u,a,m,E]),J=d.useMemo(()=>{function e(r){P==="auto"&&Xe(r.nativeEvent)&&(C.current=!m)}function n(r){C.current=P,P==="auto"&&Ye(r.nativeEvent)&&(C.current=!0)}return{onKeyDown(r){const s=u.select("open");A.current=!1;const i=r.key.startsWith("Arrow"),f=er(r.key,U(),y),O=Z(r.key,p),F=(v?f:O)||r.key==="Enter"||r.key.trim()==="";if(m&&s)return G(r);if(!(!s&&!oe&&i)){if(F){const Q=Z(r.key,U());T.current=v&&Q?null:r.key}if(v){f&&(S(r),s?(t.current=fe(o,se.current),l(r)):u.setOpen(!0,X(le,r.nativeEvent,r.currentTarget)));return}O&&(z.current!=null&&(t.current=z.current),S(r),!s&&oe?u.setOpen(!0,X(le,r.nativeEvent,r.currentTarget)):G(r),s&&l(r))}},onFocus(r){u.select("open")&&!m&&(t.current=-1,l(r))},onPointerDown:n,onPointerEnter:n,onMouseDown:e,onClick:e}},[G,se,P,o,v,l,u,oe,p,U,y,z,m]),be=d.useMemo(()=>({...j,...J}),[j,J]);return d.useMemo(()=>b?{reference:be,floating:ye,item:ie,trigger:J}:{},[b,be,ye,J,ie])}export{pr as u};
