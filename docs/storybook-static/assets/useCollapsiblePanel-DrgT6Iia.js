import{r as s}from"./index-Br2IOmUs.js";import{u as k}from"./useControlled-BhWCjR1C.js";import{u as N}from"./useIsoLayoutEffect-B3i3ZXBb.js";import{u as B}from"./useStableCallback-CgA2ffE5.js";import{u as K}from"./useBaseUiId-Ds3dA0Bv.js";import{c as U,t as z,n as V}from"./createBaseUIEventDetails-BfRHIGKf.js";import{u as G,b as J,T as W}from"./useTransitionStatus-H-zITwNf.js";import{f as Q,b as X}from"./empty-BwNtW-GQ.js";import{u as Y}from"./useOnMount-J4hPCZ9b.js";import{u as Z,A as m}from"./useAnimationFrame-BGZzLPhQ.js";function he(t){const{open:r,defaultOpen:a,onOpenChange:j,disabled:H}=t,y=r!==void 0,[p,C]=k({controlled:r,default:a,name:"Collapsible",state:"open"}),{mounted:g,setMounted:h,transitionStatus:c}=G(p,!0,!0),[u,S]=s.useState(p),[{height:d,width:b},P]=s.useState({height:void 0,width:void 0}),w=K(),[F,x]=s.useState(),L=F??w,[O,A]=s.useState(!1),[E,M]=s.useState(!1),I=s.useRef(null),f=s.useRef(null),D=s.useRef(null),v=s.useRef(null),e=J(v,!1),l=B(i=>{const n=!p,o=U(z,i.nativeEvent);if(j(n,o),o.isCanceled)return;const R=v.current;f.current==="css-animation"&&R!=null&&R.style.removeProperty("animation-name"),!O&&!E&&(f.current!=null&&f.current!=="css-animation"&&!g&&n&&h(!0),f.current==="css-animation"&&(!u&&n&&S(!0),!g&&n&&h(!0))),C(n),f.current==="none"&&g&&!n&&h(!1)});return N(()=>{y&&f.current==="none"&&!E&&!p&&h(!1)},[y,E,p,r,h]),s.useMemo(()=>({abortControllerRef:I,animationTypeRef:f,disabled:H,handleTrigger:l,height:d,mounted:g,open:p,panelId:L,panelRef:v,runOnceAnimationsFinish:e,setDimensions:P,setHiddenUntilFound:A,setKeepMounted:M,setMounted:h,setOpen:C,setPanelIdState:x,setVisible:S,transitionDimensionRef:D,transitionStatus:c,visible:u,width:b}),[I,f,H,l,d,g,p,L,v,e,P,A,M,h,C,S,D,c,u,b])}const $=s.createContext(void 0);function ge(){const t=s.useContext($);if(t===void 0)throw new Error(Q(15));return t}let T=(function(t){return t.open="data-open",t.closed="data-closed",t[t.startingStyle=W.startingStyle]="startingStyle",t[t.endingStyle=W.endingStyle]="endingStyle",t})({}),ee=(function(t){return t.panelOpen="data-panel-open",t})({});const te={[T.open]:""},ne={[T.closed]:""},ye={open(t){return t?{[ee.panelOpen]:""}:null}},Se={open(t){return t?te:ne}};let re=(function(t){return t.disabled="data-disabled",t.orientation="data-orientation",t})({});function be(t){const{abortControllerRef:r,animationTypeRef:a,externalRef:j,height:H,hiddenUntilFound:y,keepMounted:p,id:C,mounted:g,onOpenChange:h,open:c,panelRef:u,runOnceAnimationsFinish:S,setDimensions:d,setMounted:b,setOpen:P,setVisible:w,transitionDimensionRef:F,visible:x,width:L}=t,O=s.useRef(!1),A=s.useRef(null),E=s.useRef(c),M=s.useRef(c),I=Z(),f=s.useMemo(()=>a.current==="css-animation"?!x:!c&&!g,[c,g,x,a]),D=B(e=>{if(!e)return;if(a.current==null||F.current==null){const n=getComputedStyle(e),o=n.animationName!=="none"&&n.animationName!=="",R=n.transitionDuration!=="0s"&&n.transitionDuration!=="";o&&R||(n.animationName==="none"&&n.transitionDuration!=="0s"?a.current="css-transition":n.animationName!=="none"&&n.transitionDuration==="0s"?a.current="css-animation":a.current="none"),e.getAttribute(re.orientation)==="horizontal"||n.transitionProperty.indexOf("width")>-1?F.current="width":F.current="height"}if(a.current!=="css-transition")return;(H===void 0||L===void 0)&&(d({height:e.scrollHeight,width:e.scrollWidth}),M.current&&e.style.setProperty("transition-duration","0s"));let l=-1,i=-1;return l=m.request(()=>{M.current=!1,i=m.request(()=>{setTimeout(()=>{e.style.removeProperty("transition-duration")})})}),()=>{m.cancel(l),m.cancel(i)}}),v=X(j,u,D);return N(()=>{if(a.current!=="css-transition")return;const e=u.current;if(!e)return;let l=-1;if(r.current!=null&&(r.current.abort(),r.current=null),c){const i={"justify-content":e.style.justifyContent,"align-items":e.style.alignItems,"align-content":e.style.alignContent,"justify-items":e.style.justifyItems};Object.keys(i).forEach(n=>{e.style.setProperty(n,"initial","important")}),!M.current&&!p&&e.setAttribute(T.startingStyle,""),d({height:e.scrollHeight,width:e.scrollWidth}),l=m.request(()=>{Object.entries(i).forEach(([n,o])=>{o===""?e.style.removeProperty(n):e.style.setProperty(n,o)})})}else{if(e.scrollHeight===0&&e.scrollWidth===0)return;d({height:e.scrollHeight,width:e.scrollWidth});const i=new AbortController;r.current=i;const n=i.signal;let o=null;const R=T.endingStyle;return o=new MutationObserver(_=>{_.some(q=>q.type==="attributes"&&q.attributeName===R)&&(o==null||o.disconnect(),o=null,S(()=>{d({height:0,width:0}),e.style.removeProperty("content-visibility"),b(!1),r.current===i&&(r.current=null)},n))}),o.observe(e,{attributes:!0,attributeFilter:[R]}),()=>{o==null||o.disconnect(),I.cancel(),r.current===i&&(i.abort(),r.current=null)}}return()=>{m.cancel(l)}},[r,a,I,y,p,g,c,u,S,d,b]),N(()=>{if(a.current!=="css-animation")return;const e=u.current;e&&(A.current=e.style.animationName||A.current,e.style.setProperty("animation-name","none"),d({height:e.scrollHeight,width:e.scrollWidth}),!E.current&&!O.current&&e.style.removeProperty("animation-name"),c?(r.current!=null&&(r.current.abort(),r.current=null),b(!0),w(!0)):(r.current=new AbortController,S(()=>{b(!1),w(!1),r.current=null},r.current.signal)))},[r,a,c,u,S,d,b,w,x]),Y(()=>{const e=m.request(()=>{E.current=!1});return()=>m.cancel(e)}),N(()=>{if(!y)return;const e=u.current;if(!e)return;let l=-1,i=-1;return c&&O.current&&(e.style.transitionDuration="0s",d({height:e.scrollHeight,width:e.scrollWidth}),l=m.request(()=>{O.current=!1,i=m.request(()=>{setTimeout(()=>{e.style.removeProperty("transition-duration")})})})),()=>{m.cancel(l),m.cancel(i)}},[y,c,u,d]),N(()=>{const e=u.current;e&&y&&f&&(e.setAttribute("hidden","until-found"),a.current==="css-transition"&&e.setAttribute(T.startingStyle,""))},[y,f,a,u]),s.useEffect(function(){const l=u.current;if(!l)return;function i(n){O.current=!0,P(!0),h(!0,U(V,n))}return l.addEventListener("beforematch",i),()=>{l.removeEventListener("beforematch",i)}},[h,u,P]),s.useMemo(()=>({props:{hidden:f,id:C,ref:v}}),[f,C,v])}export{$ as C,ge as a,be as b,Se as c,ye as t,he as u};
