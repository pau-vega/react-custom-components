var L=Object.defineProperty;var Y=(e,t,o)=>t in e?L(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var B=(e,t,o)=>Y(e,typeof t!="symbol"?t+"":t,o);import{r}from"./index-Br2IOmUs.js";import{u as D}from"./useRenderElement-DBf0zvZM.js";import{k as U,l as y,m as _}from"./popupStateMapping-B2J1S55N.js";import{t as j,a as $}from"./useTransitionStatus-H-zITwNf.js";import{c as V,k as q,m as z}from"./createBaseUIEventDetails-BfRHIGKf.js";import{u as G}from"./useButton-D8OkA_9h.js";import{u as K}from"./useBaseUiId-Ds3dA0Bv.js";import{C as J}from"./composite-CCzA221R.js";import{j as M}from"./jsx-runtime-D_zvdyIk.js";import{F as Q,I as X,u as Z}from"./InternalBackdrop-IVVNL8k2.js";import{i as A}from"./inertValue-Cg075CKc.js";import{f as W}from"./empty-BwNtW-GQ.js";import{u as ee}from"./useStableCallback-CgA2ffE5.js";import{u as te}from"./useOpenInteractionType-DABt_JZJ.js";import{a as oe,b as ne,c as se,p as re,d as ae}from"./useSyncedFloatingRootContext-BHS4UzMP.js";import{u as ie}from"./useRole-BXNmVtjw.js";import{l as le,b as ce,R as ue,P as de,f as S}from"./useInteractions-DLoJm_bm.js";import{e as pe,d as fe}from"./element-vmEcGomw.js";const me=r.createContext(void 0);function x(e){const t=r.useContext(me);if(e===!1&&t===void 0)throw new Error(W(27));return t}const ge={...U,...j},He=r.forwardRef(function(t,o){const{render:i,className:c,forceRender:s=!1,...l}=t,{store:a}=x(),n=a.useState("open"),u=a.useState("nested"),f=a.useState("mounted"),m=a.useState("transitionStatus"),C=r.useMemo(()=>({open:n,transitionStatus:m}),[n,m]);return D("div",t,{state:C,ref:[a.context.backdropRef,o],stateAttributesMapping:ge,props:[{role:"presentation",hidden:!f,style:{userSelect:"none",WebkitUserSelect:"none"}},l],enabled:s||!u})}),Le=r.forwardRef(function(t,o){const{render:i,className:c,disabled:s=!1,nativeButton:l=!0,...a}=t,{store:n}=x(),u=n.useState("open");function f(h){u&&n.setOpen(!1,V(q,h.nativeEvent))}const{getButtonProps:m,buttonRef:C}=G({disabled:s,native:l}),O=r.useMemo(()=>({disabled:s}),[s]);return D("button",t,{state:O,ref:[o,C],props:[{onClick:f},a,m]})}),Ye=r.forwardRef(function(t,o){const{render:i,className:c,id:s,...l}=t,{store:a}=x(),n=K(s);return a.useSyncedValueWithCleanup("descriptionElementId",n),D("p",t,{ref:o,props:[{id:n},l]})});let Se=(function(e){return e.nestedDialogs="--nested-dialogs",e})({}),Ce=(function(e){return e[e.open=y.open]="open",e[e.closed=y.closed]="closed",e[e.startingStyle=y.startingStyle]="startingStyle",e[e.endingStyle=y.endingStyle]="endingStyle",e.nested="data-nested",e.nestedDialogOpen="data-nested-dialog-open",e})({});const H=r.createContext(void 0);function he(){const e=r.useContext(H);if(e===void 0)throw new Error(W(26));return e}const Re={...U,...j,nestedDialogOpen(e){return e?{[Ce.nestedDialogOpen]:""}:null}},_e=r.forwardRef(function(t,o){const{className:i,finalFocus:c,initialFocus:s,render:l,...a}=t,{store:n}=x(),u=n.useState("descriptionElementId"),f=n.useState("disablePointerDismissal"),m=n.useState("floatingRootContext"),C=n.useState("popupProps"),O=n.useState("modal"),h=n.useState("mounted"),R=n.useState("nested"),I=n.useState("nestedOpenDialogCount"),E=n.useState("open"),w=n.useState("openMethod"),T=n.useState("titleElementId"),b=n.useState("transitionStatus"),P=n.useState("role");he(),$({open:E,ref:n.context.popupRef,onComplete(){var d,g;E&&((g=(d=n.context).onOpenChangeComplete)==null||g.call(d,!0))}});function v(d){return d==="touch"?n.context.popupRef.current:!0}const F=s===void 0?v:s,k=I>0,N=r.useMemo(()=>({open:E,nested:R,transitionStatus:b,nestedDialogOpen:k}),[E,R,b,k]),p=D("div",t,{state:N,props:[C,{"aria-labelledby":T??void 0,"aria-describedby":u??void 0,role:P,tabIndex:-1,hidden:!h,onKeyDown(d){J.has(d.key)&&d.stopPropagation()},style:{[Se.nestedDialogs]:I}},a],ref:[o,n.context.popupRef,n.useStateSetter("popupElement")],stateAttributesMapping:Re});return M.jsx(Q,{context:m,openInteractionType:w,disabled:!h,closeOnFocusOut:!f,initialFocus:F,returnFocus:c,modal:O!==!1,restoreFocus:"popup",children:p})}),$e=r.forwardRef(function(t,o){const{keepMounted:i=!1,...c}=t,{store:s}=x(),l=s.useState("mounted"),a=s.useState("modal"),n=s.useState("open");return l||i?M.jsx(H.Provider,{value:i,children:M.jsxs(_,{ref:o,...c,children:[l&&a===!0&&M.jsx(X,{ref:s.context.internalBackdropRef,inert:A(!n)}),t.children]})}):null});function qe(e){const{store:t,parentContext:o,actionsRef:i}=e,c=t.useState("open"),s=t.useState("disablePointerDismissal"),l=t.useState("modal"),a=t.useState("popupElement"),{openMethod:n,triggerProps:u,reset:f}=te(c);oe(t);const{forceUnmount:m}=ne(c,t,()=>{f()}),C=ee(p=>{const d=V(p);return d.preventUnmountOnClose=()=>{t.set("preventUnmountingOnClose",!0)},d}),O=r.useCallback(()=>{t.setOpen(!1,C(z))},[t,C]);r.useImperativeHandle(i,()=>({unmount:m,close:O}),[m,O]);const h=se({popupStore:t,onOpenChange:t.setOpen,treatPopupAsFloatingElement:!0,noEmit:!0}),[R,I]=r.useState(0),E=R===0,w=ie(h),T=le(h,{outsidePressEvent(){return t.context.internalBackdropRef.current||t.context.backdropRef.current?"intentional":{mouse:l==="trap-focus"?"sloppy":"intentional",touch:"sloppy"}},outsidePress(p){if("button"in p&&p.button!==0||"touches"in p&&p.touches.length!==1)return!1;const d=pe(p);if(E&&!s){const g=d;return l&&(t.context.internalBackdropRef.current||t.context.backdropRef.current)?t.context.internalBackdropRef.current===g||t.context.backdropRef.current===g||fe(g,a)&&!(g!=null&&g.hasAttribute("data-base-ui-portal")):!0}return!1},escapeKey:E});Z(c&&l===!0,a);const{getReferenceProps:b,getFloatingProps:P,getTriggerProps:v}=ce([w,T]);t.useContextCallback("onNestedDialogOpen",p=>{I(p+1)}),t.useContextCallback("onNestedDialogClose",()=>{I(0)}),r.useEffect(()=>(o!=null&&o.onNestedDialogOpen&&c&&o.onNestedDialogOpen(R),o!=null&&o.onNestedDialogClose&&!c&&o.onNestedDialogClose(),()=>{o!=null&&o.onNestedDialogClose&&c&&o.onNestedDialogClose()}),[c,o,R]);const F=r.useMemo(()=>b(u),[b,u]),k=r.useMemo(()=>v(u),[v,u]),N=r.useMemo(()=>P(),[P]);t.useSyncedValues({openMethod:n,activeTriggerProps:F,inactiveTriggerProps:k,popupProps:N,floatingRootContext:h,nestedOpenDialogCount:R})}const Ee={...re,modal:S(e=>e.modal),nested:S(e=>e.nested),nestedOpenDialogCount:S(e=>e.nestedOpenDialogCount),disablePointerDismissal:S(e=>e.disablePointerDismissal),openMethod:S(e=>e.openMethod),descriptionElementId:S(e=>e.descriptionElementId),titleElementId:S(e=>e.titleElementId),viewportElement:S(e=>e.viewportElement),role:S(e=>e.role)};class ze extends ue{constructor(o){super(Oe(o),{popupRef:r.createRef(),backdropRef:r.createRef(),internalBackdropRef:r.createRef(),triggerElements:new de,onOpenChange:void 0,onOpenChangeComplete:void 0},Ee);B(this,"setOpen",(o,i)=>{var a,n,u,f;if(i.preventUnmountOnClose=()=>{this.set("preventUnmountingOnClose",!0)},!o&&i.trigger==null&&this.state.activeTriggerId!=null&&(i.trigger=this.state.activeTriggerElement??void 0),(n=(a=this.context).onOpenChange)==null||n.call(a,o,i),i.isCanceled)return;const c={open:o,nativeEvent:i.event,reason:i.reason,nested:this.state.nested};(u=this.state.floatingRootContext.context.events)==null||u.emit("openchange",c);const s={open:o},l=((f=i.trigger)==null?void 0:f.id)??null;(l||o)&&(s.activeTriggerId=l,s.activeTriggerElement=i.trigger??null),this.update(s)})}}function Oe(e={}){return{...ae(),modal:!0,disablePointerDismissal:!1,popupElement:null,viewportElement:null,descriptionElementId:void 0,titleElementId:void 0,openMethod:null,nested:!1,nestedOpenDialogCount:0,role:"dialog",...e}}const Ge=r.forwardRef(function(t,o){const{render:i,className:c,id:s,...l}=t,{store:a}=x(),n=K(s);return a.useSyncedValueWithCleanup("titleElementId",n),D("h2",t,{ref:o,props:[{id:n},l]})});export{me as D,qe as a,ze as b,_e as c,Le as d,Ge as e,Ye as f,$e as g,He as h,x as u};
