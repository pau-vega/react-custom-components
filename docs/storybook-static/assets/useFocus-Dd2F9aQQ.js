import{r as a}from"./index-Br2IOmUs.js";import{g as x,i as d,a as S}from"./floating-ui.utils.dom-BR__G8pa.js";import{b as A,c as C}from"./detectBrowser-Cp-v3zjv.js";import{u as B}from"./useTimeout-DEENwbcq.js";import{c as b,a as T,t as K,e as P}from"./createBaseUIEventDetails-BfRHIGKf.js";import{c as V}from"./useInteractions-DLoJm_bm.js";import{b as D,d as y,e as G,i as H,m as W,c as j}from"./element-vmEcGomw.js";const h=A&&C;function X(g,O={}){const t="rootStore"in g?g.rootStore:g,{events:E,dataRef:w}=t.context,{enabled:i=!0,visibleOnly:L=!0,delay:m}=O,c=a.useRef(!1),l=a.useRef(null),p=B(),v=a.useRef(!0);a.useEffect(()=>{const r=t.select("domReferenceElement");if(!i)return;const e=x(r);function n(){const o=t.select("domReferenceElement");!t.select("open")&&S(o)&&o===D(j(o))&&(c.current=!0)}function f(){v.current=!0}function s(){v.current=!1}return e.addEventListener("blur",n),h&&(e.addEventListener("keydown",f,!0),e.addEventListener("pointerdown",s,!0)),()=>{e.removeEventListener("blur",n),h&&(e.removeEventListener("keydown",f,!0),e.removeEventListener("pointerdown",s,!0))}},[t,i]),a.useEffect(()=>{if(!i)return;function r(e){if(e.reason===K||e.reason===P){const n=t.select("domReferenceElement");d(n)&&(l.current=n,c.current=!0)}}return E.on("openchange",r),()=>{E.off("openchange",r)}},[E,i,t]);const R=a.useMemo(()=>({onMouseLeave(){c.current=!1,l.current=null},onFocus(r){const e=r.currentTarget;if(c.current){if(l.current===e)return;c.current=!1,l.current=null}const n=G(r.nativeEvent);if(L&&d(n)){if(h&&!r.relatedTarget){if(!v.current&&!H(n))return}else if(!W(n))return}const f=r.relatedTarget&&t.context.triggerElements.hasElement(r.relatedTarget),{nativeEvent:s,currentTarget:o}=r,u=typeof m=="function"?m():m;if(t.select("open")&&f||u===0||u===void 0){t.setOpen(!0,b(T,s,o));return}p.start(u,()=>{c.current||t.setOpen(!0,b(T,s,o))})},onBlur(r){c.current=!1,l.current=null;const e=r.relatedTarget,n=r.nativeEvent,f=d(e)&&e.hasAttribute(V("focus-guard"))&&e.getAttribute("data-type")==="outside";p.start(0,()=>{var F;const s=t.select("domReferenceElement"),o=D(s?s.ownerDocument:document);if(!e&&o===s||y((F=w.current.floatingContext)==null?void 0:F.refs.floating.current,o)||y(s,o)||f)return;const u=e??o;if(d(u)){const M=t.context.triggerElements;if(M.hasElement(u)||M.hasMatchingElement(k=>y(k,u)))return}t.setOpen(!1,b(T,n))})}}),[w,t,L,p,m]);return a.useMemo(()=>i?{reference:R,trigger:R}:{},[i,R])}export{X as u};
