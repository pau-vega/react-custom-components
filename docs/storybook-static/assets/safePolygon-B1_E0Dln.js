import{r as R}from"./index-Br2IOmUs.js";import{i as re}from"./floating-ui.utils.dom-BR__G8pa.js";import{u as se,T as le}from"./useTimeout-DEENwbcq.js";import{u as ee}from"./useValueAsRef-uCcb0GiG.js";import{u as U}from"./useStableCallback-CgA2ffE5.js";import{u as ie}from"./useIsoLayoutEffect-B3i3ZXBb.js";import{a as ae,u as de,c as me,g as ge}from"./useInteractions-DLoJm_bm.js";import{c as G,b as J}from"./createBaseUIEventDetails-BfRHIGKf.js";import{T as Ee}from"./constants-CRqqCNE_.js";import{c as x,e as fe,d as K}from"./element-vmEcGomw.js";import{i as oe}from"./event-D_tFMKDJ.js";const ce=me("safe-polygon"),he=`button,[role="button"],select,[tabindex]:not([tabindex="-1"]),${Ee}`;function ve(c){return c?!!c.closest(he):!1}function te(c,e,s){if(s&&!oe(s))return 0;if(typeof c=="number")return c;if(typeof c=="function"){const u=c();return typeof u=="number"?u:u==null?void 0:u[e]}return c==null?void 0:c[e]}function ne(c){return typeof c=="function"?c():c}function ke(c,e={}){const s="rootStore"in c?c.rootStore:c,u=s.useState("open"),m=s.useState("floatingElement"),b=s.useState("domReferenceElement"),{dataRef:h,events:Y}=s.context,{enabled:g=!0,delay:j=0,handleClose:V=null,mouseOnly:v=!1,restMs:k=0,move:A=!0,triggerElement:O=null,externalTree:W}=e,S=ae(W),$=de(),y=ee(V),C=ee(j),D=ee(k),F=R.useRef(void 0),_=R.useRef(!1),T=se(),q=R.useRef(void 0),L=se(),Q=R.useRef(!0),z=R.useRef(!1),f=R.useRef(()=>{}),t=R.useRef(!1),X=U(()=>{var i;const o=(i=h.current.openEvent)==null?void 0:i.type;return(o==null?void 0:o.includes("mouse"))&&o!=="mousedown"}),p=U(()=>_.current?!0:h.current.openEvent?["click","mousedown"].includes(h.current.openEvent.type):!1);R.useEffect(()=>{if(!g)return;function o(i){i.open||(T.clear(),L.clear(),Q.current=!0,t.current=!1)}return Y.on("openchange",o),()=>{Y.off("openchange",o)}},[g,Y,T,L]),R.useEffect(()=>{if(!g||!y.current||!u)return;function o(a){p()||X()&&s.setOpen(!1,G(J,a,a.currentTarget??void 0))}const i=x(m).documentElement;return i.addEventListener("mouseleave",o),()=>{i.removeEventListener("mouseleave",o)}},[m,u,s,g,y,X,p]);const P=R.useCallback((o,i=!0)=>{const a=te(C.current,"close",F.current);a&&!q.current?T.start(a,()=>s.setOpen(!1,G(J,o))):i&&(T.clear(),s.setOpen(!1,G(J,o)))},[C,s,T]),H=U(()=>{f.current(),q.current=void 0}),l=U(()=>{if(z.current){const o=x(m).body;o.style.pointerEvents="",o.removeAttribute(ce),z.current=!1}}),M=U(o=>{const i=fe(o);if(!ve(i)){_.current=!1;return}_.current=!0});R.useEffect(()=>{if(!g)return;function o(n){if(T.clear(),Q.current=!1,v&&!oe(F.current)||ne(D.current)>0&&!te(C.current,"open"))return;const E=te(C.current,"open",F.current),d=n.currentTarget??void 0,B=s.select("domReferenceElement"),Z=B&&d&&!K(B,d);E?T.start(E,()=>{s.select("open")||s.setOpen(!0,G(J,n,d))}):(!u||Z)&&s.setOpen(!0,G(J,n,d))}function i(n){if(p()){l();return}f.current();const E=x(m);L.clear(),t.current=!1;const d=s.context.triggerElements;if(n.relatedTarget&&d.hasElement(n.relatedTarget))return;if(y.current&&h.current.floatingContext){u||T.clear(),q.current=y.current({...h.current.floatingContext,tree:S,x:n.clientX,y:n.clientY,onClose(){l(),H(),p()||P(n,!0)}});const Z=q.current;E.addEventListener("mousemove",Z),f.current=()=>{E.removeEventListener("mousemove",Z)};return}(F.current==="touch"?!K(m,n.relatedTarget):!0)&&P(n)}function a(n){var d;if(p()||!h.current.floatingContext||!s.select("open"))return;const E=s.context.triggerElements;n.relatedTarget&&E.hasElement(n.relatedTarget)||(d=y.current)==null||d.call(y,{...h.current.floatingContext,tree:S,x:n.clientX,y:n.clientY,onClose(){l(),H(),p()||P(n)}})(n)}function w(){T.clear(),l()}function I(n){p()||P(n,!1)}const r=O??b;if(re(r)){const n=m;return u&&r.addEventListener("mouseleave",a),A&&r.addEventListener("mousemove",o,{once:!0}),r.addEventListener("mouseenter",o),r.addEventListener("mouseleave",i),n&&(n.addEventListener("mouseleave",a),n.addEventListener("mouseenter",w),n.addEventListener("mouseleave",I),n.addEventListener("pointerdown",M,!0)),()=>{u&&r.removeEventListener("mouseleave",a),A&&r.removeEventListener("mousemove",o),r.removeEventListener("mouseenter",o),r.removeEventListener("mouseleave",i),n&&(n.removeEventListener("mouseleave",a),n.removeEventListener("mouseenter",w),n.removeEventListener("mouseleave",I),n.removeEventListener("pointerdown",M,!0))}}},[g,v,A,b,m,O,s,P,H,l,u,S,C,y,h,p,D,T,L,M]),ie(()=>{var o,i,a,w;if(g&&u&&(i=(o=y.current)==null?void 0:o.__options)!=null&&i.blockPointerEvents&&X()){z.current=!0;const I=m;if(re(b)&&I){const r=x(m).body;r.setAttribute(ce,"");const n=b,E=(w=(a=S==null?void 0:S.nodesRef.current.find(d=>d.id===$))==null?void 0:a.context)==null?void 0:w.elements.floating;return E&&(E.style.pointerEvents=""),r.style.pointerEvents="none",n.style.pointerEvents="auto",I.style.pointerEvents="auto",()=>{r.style.pointerEvents="",n.style.pointerEvents="",I.style.pointerEvents=""}}}},[g,u,$,S,y,X,b,m]),ie(()=>{u||(F.current=void 0,t.current=!1,_.current=!1,H(),l())},[u,H,l]),R.useEffect(()=>()=>{H(),T.clear(),L.clear(),_.current=!1},[g,b,H,T,L]),R.useEffect(()=>l,[l]);const N=R.useMemo(()=>{function o(i){F.current=i.pointerType}return{onPointerDown:o,onPointerEnter:o,onMouseMove(i){const{nativeEvent:a}=i,w=i.currentTarget,I=s.select("domReferenceElement")&&!K(s.select("domReferenceElement"),i.target);function r(){!Q.current&&(!s.select("open")||I)&&s.setOpen(!0,G(J,a,w))}v&&!oe(F.current)||s.select("open")&&!I||ne(D.current)===0||!I&&t.current&&i.movementX**2+i.movementY**2<2||(L.clear(),F.current==="touch"||I?r():(t.current=!0,L.start(ne(D.current),r)))}}},[v,s,D,L]);return R.useMemo(()=>g?{reference:N}:{},[g,N])}function ue(c,e){const[s,u]=c;let m=!1;const b=e.length;for(let h=0,Y=b-1;h<b;Y=h++){const[g,j]=e[h]||[0,0],[V,v]=e[Y]||[0,0];j>=u!=v>=u&&s<=(V-g)*(u-j)/(v-j)+g&&(m=!m)}return m}function pe(c,e){return c[0]>=e.x&&c[0]<=e.x+e.width&&c[1]>=e.y&&c[1]<=e.y+e.height}function Se(c={}){const{buffer:e=.5,blockPointerEvents:s=!1,requireIntent:u=!0}=c,m=new le;let b=!1,h=null,Y=null,g=typeof performance<"u"?performance.now():0;function j(v,k){const A=performance.now(),O=A-g;if(h===null||Y===null||O===0)return h=v,Y=k,g=A,null;const W=v-h,S=k-Y,y=Math.sqrt(W*W+S*S)/O;return h=v,Y=k,g=A,y}const V=({x:v,y:k,placement:A,elements:O,onClose:W,nodeId:S,tree:$})=>function(C){function D(){m.clear(),W()}if(m.clear(),!O.domReference||!O.floating||A==null||v==null||k==null)return;const{clientX:F,clientY:_}=C,T=[F,_],q=fe(C),L=C.type==="mouseleave",Q=K(O.floating,q),z=K(O.domReference,q),f=O.domReference.getBoundingClientRect(),t=O.floating.getBoundingClientRect(),X=A.split("-")[0],p=v>t.right-t.width/2,P=k>t.bottom-t.height/2,H=pe(T,f),l=t.width>f.width,M=t.height>f.height,N=(l?f:t).left,o=(l?f:t).right,i=(M?f:t).top,a=(M?f:t).bottom;if(Q&&(b=!0,!L))return;if(z&&(b=!1),z&&!L){b=!0;return}if(L&&re(C.relatedTarget)&&K(O.floating,C.relatedTarget)||$&&ge($.nodesRef.current,S).some(({context:r})=>r==null?void 0:r.open))return;if(X==="top"&&k>=f.bottom-1||X==="bottom"&&k<=f.top+1||X==="left"&&v>=f.right-1||X==="right"&&v<=f.left+1)return D();let w=[];switch(X){case"top":w=[[N,f.top+1],[N,t.bottom-1],[o,t.bottom-1],[o,f.top+1]];break;case"bottom":w=[[N,t.top+1],[N,f.bottom-1],[o,f.bottom-1],[o,t.top+1]];break;case"left":w=[[t.right-1,a],[t.right-1,i],[f.left+1,i],[f.left+1,a]];break;case"right":w=[[f.right-1,a],[f.right-1,i],[t.left+1,i],[t.left+1,a]];break}function I([r,n]){switch(X){case"top":{const E=[l?r+e/2:p?r+e*4:r-e*4,n+e+1],d=[l?r-e/2:p?r+e*4:r-e*4,n+e+1],B=[[t.left,p||l?t.bottom-e:t.top],[t.right,p?l?t.bottom-e:t.top:t.bottom-e]];return[E,d,...B]}case"bottom":{const E=[l?r+e/2:p?r+e*4:r-e*4,n-e],d=[l?r-e/2:p?r+e*4:r-e*4,n-e],B=[[t.left,p||l?t.top+e:t.bottom],[t.right,p?l?t.top+e:t.bottom:t.top+e]];return[E,d,...B]}case"left":{const E=[r+e+1,M?n+e/2:P?n+e*4:n-e*4],d=[r+e+1,M?n-e/2:P?n+e*4:n-e*4];return[...[[P||M?t.right-e:t.left,t.top],[P?M?t.right-e:t.left:t.right-e,t.bottom]],E,d]}case"right":{const E=[r-e,M?n+e/2:P?n+e*4:n-e*4],d=[r-e,M?n-e/2:P?n+e*4:n-e*4],B=[[P||M?t.left+e:t.right,t.top],[P?M?t.left+e:t.right:t.left+e,t.bottom]];return[E,d,...B]}default:return[]}}if(!ue([F,_],w)){if(b&&!H)return D();if(!L&&u){const r=j(C.clientX,C.clientY);if(r!==null&&r<.1)return D()}ue([F,_],I([v,k]))?!b&&u&&m.start(40,D):D()}};return V.__options={blockPointerEvents:s},V}export{te as g,Se as s,ke as u};
