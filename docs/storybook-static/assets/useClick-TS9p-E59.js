import{r as k}from"./index-Br2IOmUs.js";import{u as P}from"./useAnimationFrame-BGZzLPhQ.js";import{u as b}from"./useTimeout-DEENwbcq.js";import{c as v,t as y}from"./createBaseUIEventDetails-BfRHIGKf.js";import{i as M,a as x}from"./event-D_tFMKDJ.js";import{i as I}from"./element-vmEcGomw.js";import{E as L}from"./empty-BwNtW-GQ.js";function Y(d,R={}){const e="rootStore"in d?d.rootStore:d,T=e.context.dataRef,{enabled:h=!0,event:p="click",toggle:g=!0,ignoreMouse:E=!1,stickIfOpen:O=!0,touchOpenDelay:n=0}=R,c=k.useRef(void 0),C=P(),f=b(),w=k.useMemo(()=>({onPointerDown(t){c.current=t.pointerType},onMouseDown(t){const r=c.current,o=t.nativeEvent,i=e.select("open");if(t.button!==0||p==="click"||M(r,!0)&&E)return;const s=T.current.openEvent,u=s==null?void 0:s.type,m=e.select("domReferenceElement")!==t.currentTarget,l=i&&m||!(i&&g&&(!(s&&O)||u==="click"||u==="mousedown"));if(I(o.target)){const a=v(y,o,o.target);l&&r==="touch"&&n>0?f.start(n,()=>{e.setOpen(!0,a)}):e.setOpen(l,a);return}const D=t.currentTarget;C.request(()=>{const a=v(y,o,D);l&&r==="touch"&&n>0?f.start(n,()=>{e.setOpen(!0,a)}):e.setOpen(l,a)})},onClick(t){if(p==="mousedown-only")return;const r=c.current;if(p==="mousedown"&&r){c.current=void 0;return}if(M(r,!0)&&E)return;const o=e.select("open"),i=T.current.openEvent,s=e.select("domReferenceElement")!==t.currentTarget,u=o&&s||!(o&&g&&(!(i&&O)||x(i))),m=v(y,t.nativeEvent,t.currentTarget);u&&r==="touch"&&n>0?f.start(n,()=>{e.setOpen(!0,m)}):e.setOpen(u,m)},onKeyDown(){c.current=void 0}}),[T,p,E,e,O,g,C,f,n]);return k.useMemo(()=>h?{reference:w}:L,[h,w])}export{Y as u};
