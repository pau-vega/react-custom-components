import{r as x}from"./index-Br2IOmUs.js";import{C as se}from"./CompositeList-qs3wigw5.js";import{i as oe}from"./isElementDisabled-CwHw_lZC.js";import{u as Z}from"./useStableCallback-CgA2ffE5.js";import{b as ie,a as q,E as re}from"./empty-BwNtW-GQ.js";import{s as v,A as ae,a as de,i as J,b as z,c as j,H as le,E as ce,d as $,e as B,V as fe,f as ue,g as he,h as ge,M as Ie}from"./composite-CCzA221R.js";import{g as me,a as xe,c as pe,b as U,d as Re,e as Ee,f as ye,h as Ce,i as be}from"./composite-RvPlRQ7I.js";import{C as Ae}from"./useButton-D8OkA_9h.js";import{u as Ke}from"./useRenderElement-DBf0zvZM.js";import{u as _e}from"./DirectionContext-DcsIbjZ7.js";import{j as Q}from"./jsx-runtime-D_zvdyIk.js";const Me="data-composite-item-active",Se=[];function ke(p){const{itemSizes:C,cols:l=1,loopFocus:R=!0,dense:S=!1,orientation:s="both",direction:E,highlightedIndex:D,onHighlightedIndexChange:P,rootRef:N,enableHomeAndEndKeys:g=!1,stopEventPropagation:k=!1,disabledIndices:i,modifierKeys:H=Se}=p,[G,b]=x.useState(0),A=l>1,I=x.useRef(null),O=ie(I,N),t=x.useRef([]),K=x.useRef(!1),a=D??G,m=Z((e,o=!1)=>{if((P??b)(e),o){const c=t.current[e];v(I.current,c,E,s)}}),T=Z(e=>{if(e.size===0||K.current)return;K.current=!0;const o=Array.from(e.keys()),c=o.find(r=>r==null?void 0:r.hasAttribute(Me))??null,f=c?o.indexOf(c):-1;f!==-1&&m(f),v(I.current,c,E,s)}),_=x.useMemo(()=>({"aria-orientation":s==="both"?void 0:s,ref:O,onFocus(e){!I.current||!J(e.target)||e.target.setSelectionRange(0,e.target.value.length??0)},onKeyDown(e){const o=g?ae:de;if(!o.has(e.key)||He(e,H)||!I.current)return;const f=E==="rtl",r=f?$:j,W={horizontal:r,vertical:z,both:r}[s],y=f?j:$,Y={horizontal:y,vertical:B,both:y}[s];if(J(e.target)&&!oe(e.target)){const d=e.target.selectionStart,u=e.target.selectionEnd,F=e.target.value??"";if(d==null||e.shiftKey||d!==u||e.key!==Y&&d<F.length||e.key!==W&&d>0)return}let n=a;const L=me(t,i),w=xe(t,i);if(A){const d=C||Array.from({length:t.current.length},()=>({width:1,height:1})),u=pe(d,l,S),F=u.findIndex(h=>h!=null&&!U(t,h,i)),te=u.reduce((h,M,ne)=>M!=null&&!U(t,M,i)?ne:h,-1);n=u[Re({current:u.map(h=>h?t.current[h]:null)},{event:e,orientation:s,loopFocus:R,cols:l,disabledIndices:ye([...i||t.current.map((h,M)=>U(t,M)?M:void 0),void 0],u),minIndex:F,maxIndex:te,prevIndex:Ee(a>w?L:a,d,u,l,e.key===z?"bl":e.key===j?"tr":"tl"),rtl:f})]}const X={horizontal:[r],vertical:[z],both:[r,z]}[s],V={horizontal:[y],vertical:[B],both:[y,B]}[s],ee=A?o:{horizontal:g?he:ge,vertical:g?fe:ue,both:o}[s];g&&(e.key===le?n=L:e.key===ce&&(n=w)),n===a&&(X.includes(e.key)||V.includes(e.key))&&(R&&n===w&&X.includes(e.key)?n=L:R&&n===L&&V.includes(e.key)?n=w:n=Ce(t,{startingIndex:n,decrement:V.includes(e.key),disabledIndices:i})),n!==a&&!be(t,n)&&(k&&e.stopPropagation(),ee.has(e.key)&&e.preventDefault(),m(n,!0),queueMicrotask(()=>{var d;(d=t.current[n])==null||d.focus()}))}}),[l,S,E,i,t,g,a,A,C,R,O,H,m,s,k]);return x.useMemo(()=>({props:_,highlightedIndex:a,onHighlightedIndexChange:m,elementsRef:t,disabledIndices:i,onMapChange:T,relayKeyboardEvent:_.onKeyDown}),[_,a,m,t,i,T])}function He(p,C){for(const l of Ie.values())if(!C.includes(l)&&p.getModifierState(l))return!0;return!1}function Ve(p){const{render:C,className:l,refs:R=q,props:S=q,state:s=re,stateAttributesMapping:E,highlightedIndex:D,onHighlightedIndexChange:P,orientation:N,dense:g,itemSizes:k,loopFocus:i,cols:H,enableHomeAndEndKeys:G,onMapChange:b,stopEventPropagation:A=!0,rootRef:I,disabledIndices:O,modifierKeys:t,highlightItemOnHover:K=!1,tag:a="div",...m}=p,T=_e(),{props:_,highlightedIndex:e,onHighlightedIndexChange:o,elementsRef:c,onMapChange:f,relayKeyboardEvent:r}=ke({itemSizes:k,cols:H,loopFocus:i,dense:g,orientation:N,highlightedIndex:D,onHighlightedIndexChange:P,rootRef:I,stopEventPropagation:A,enableHomeAndEndKeys:G,direction:T,disabledIndices:O,modifierKeys:t}),W=Ke(a,p,{state:s,ref:R,props:[_,...S,m],stateAttributesMapping:E}),y=x.useMemo(()=>({highlightedIndex:e,onHighlightedIndexChange:o,highlightItemOnHover:K,relayKeyboardEvent:r}),[e,o,K,r]);return Q.jsx(Ae.Provider,{value:y,children:Q.jsx(se,{elementsRef:c,onMapChange:Y=>{b==null||b(Y),f(Y)},children:W})})}export{Me as A,Ve as C};
